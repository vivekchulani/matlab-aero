function [dCm_theta, dCm_theta_M] = Fig_dcm_theta(SweepC4, A, Taper, M)
%[dCm_theta, dCm_theta_M] = Fig_dcm_theta(SweepC4, A, Taper, M)
%Change in pitching moment (CM) due to twist (theta), Datcom 
%Figure 4.1.4.1.5 including Mach effects, Datcom Figure 4.1.4.1.6
%Input
%SweepC4 = Quarter Chord sweep
%Aspect Ratio
%TR = Taper ratio
%M = Subsonic Mach Number
%Output
%dCm_theta   = Change in pitching moment due to twist
%dCm_theta_M = Correction for compressibility effects (Mach)

%Datcom Figure 4.1.4.1.5-A, B and C
%Taper Ratio
    X3 = [0.,.5,1.];
%Aspect Ratio
    X2 = [10.,8.,6.,3.5,1.5];
%c/4 Sweep
    X = [-45.,-40.,-35.,-30.,-25.,-20.,-15.,-10.,-5., 0., ...
         5.,10.,15.,20.,25.,30.,35.,40.,45.,50.,55.,60.];
%dCmo_theta
    Y = {{[.0116, .0100, .0085, .0072, .0060, .0048, .0036, .0024, ...
           .0012, .0000,-.0012,-.0024,-.0037,-.0050,-.0063,-.0076, ...
          -.0090,-.0104,-.0118,-.0131,-.0145,-.0159]
          [.0081, .0070, .0061, .0051, .0042, .0034, .0025, .0017, ...
           .0008, .0000,-.0009,-.0017,-.0026,-.0035,-.0045,-.0055, ...
          -.0065,-.0076,-.0086,-.0097,-.0108,-.011]
          [.0052, .0045, .0039, .0033, .0027, .0022, .0016, .0011, ...
           .0005, .0000,-.0005,-.0011,-.0017,-.0023,-.0029,-.0035, ...
          -.0042,-.0049,-.0057,-.0063,-.0070,-.0078]
          [.0022, .0019, .0016, .0014, .0011, .0009, .0007, .0004, ...
           .0002, .0000,-.0002,-.0004,-.0007,-.0009,-.0012,-.0014, ...
          -.0017,-.0021,-.0024,-.0027,-.0032,-.0036];
          [.0005, .0004, .0004, .0003, .0002, .0002, .0001, .0001, ...
           .0000, .0000,-.0000,-.0001,-.0001,-.0002,-.0002,-.0003, ...
          -.0004,-.0004,-.0005,-.0006,-.0007,-.0008]};
      
         {[.0204, .0177, .0152, .0128, .0105, .0083, .0061, .0041, ...
           .0020, .0000,-.0020,-.0040,-.0060,-.0080,-.0100,-.0121, ...
          -.0141,-.0162,-.0182,-.0208,-.0232,-.0257]
          [.0144, .0125, .0107, .0090, .0073, .0058, .0043, .0028, ...
           .0014, .0000,-.0014,-.0028,-.0042,-.0056,-.0071,-.0086, ...
          -.0102,-.0117,-.0133,-.0153,-.0172,-.0193]
          [.0091, .0078, .0066, .0055, .0045, .0035  .0026, .0017, ...
           .0009, .0000,-.0009,-.0017,-.0026,-.0035,-.0044,-.0054, ...
          -.0064,-.0075,-.0087,-.0099,-.0113,-.0128]
          [.0036, .0030, .0026, .0021, .0017, .0013, .0010, .0007, ...
           .0003, .0000,-.0003 -.0007,-.0010,-.0013,-.0017,-.0021, ...
          -.0025,-.0030,-.0036,-.0043,-.0050,-.0058]
          [.0007, .0006, .0005, .0004, .0003, .0003, .0002, .0001, ...
           .0001, .0000,-.0001,-.0001,-.0002,-.0003,-.0003,-.0004, ...
          -.0005,-.0006,-.0007,-.0008,-.0009,-.0010]};

         {[.0218, .0189, .0162, .0135, .0111, .0087, .0064, .0042, ...
           .0021, .0000,-.0020,-.0041,-.0061,-.0081,-.0101,-.0121, ...
          -.0141,-.0162,-.0182,-.0202,-.0222,-.0243]
          [.0154, .0133, .0113, .0095, .0077, .0060, .0044, .0029, ...
           .0014, .0000,-.0014,-.0028,-.0043,-.0057,-.0072,-.0087, ...
          -.0102,-.0117,-.0133,-.0148,-.0163,-.0179]
          [.0097, .0083, .0070, .0058, .0047, .0037, .0027, .0018, ...
           .0009, .0000,-.0009,-.0018,-.0027,-.0036,-.0045,-.0055, ...
          -.0065,-.0075,-.0086,-.0098,-.0108,-.0119]
          [.0038, .0032, .0027, .0022, .0018, .0014, .0010, .0007, ...
           .0003, .0000,-.0003,-.0007,-.0010,-.0014,-.0018,-.0022, ...
          -.0026,-.0031,-.0036,-.0043,-.0050,-.0057]
          [.0008, .0006, .0005, .0004, .0003, .0003, .0002, .0001, ...
           .0001, .0000,-.0001,-.0001,-.0002,-.0003,-.0003,-.0004, ...
          -.0005,-.0006,-.0007,-.0008,-.0009,-.0010]}};
        
    %perform interpolation
    nmY = length(X3);
    nmX2 = length(X2);
    Y1 = cell(size(nmY));
    Y2 = zeros(size(nmX2));
    
    for i=1:nmY
        for j=1:nmX2
            %interpolate by sweep for each graph under each aspect ratio
            %and taper ratio
            Y1{i}(j) = interp1(X,Y{i}{j},SweepC4,'spline','extrap');
        end % end sweep
        %interpolate by aspect ratio for each graph under taper ratio
        Y2(i) = interp1(X2,Y1{i},A,'linear','extrap');
    end %end aspect ratio
    %interpolate by taper ratio
    dCm_theta = interp1(X3,Y2,Taper,'spline');

%Datcom Figure 4.1.4.1.6
%Correct for Subsonic Mach Effects
    MX = [0.000, 0.050, 0.100, 0.150, 0.200, 0.250, ...
          0.300, 0.350, 0.400, 0.450, 0.500, 0.550, ...
          0.600, 0.650, 0.700, 0.750, 0.800, 0.850, 0.900];
    MY = [1.000, 1.000, 1.000, 1.000, 1.000, 1.000, ...
          1.005, 1.017, 1.031, 1.050, 1.072, 1.101, ...
          1.132, 1.162, 1.197, 1.237, 1.287, 1.355, 1.445];
    dCm_theta_M = interp1(MX,MY,M,'spline');

end